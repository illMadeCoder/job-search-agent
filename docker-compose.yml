# Job Search Agent - Docker Compose
#
# Usage:
#   docker compose run --rm agent daily    # Run daily job search (5am)
#   docker compose run --rm agent hourly   # Run hourly monitor (6am-9pm EST)
#   docker compose run --rm agent health   # Run health check
#   docker compose run --rm agent shell    # Interactive shell
#
# Your data directory should contain:
#   - config.yaml
#   - gmail-tokens*.json
#   - credentials.json
#   - linkedin_archive/
#   - postings/
#   - digest/
#   - logs/

services:
  agent:
    build: .
    user: "1000:1000"  # Run as non-root (adjust to your UID)

    # Mount repo root as workspace (includes config.yaml, resume, postings, digest)
    volumes:
      - .:/home/agent/job-search

      # Mount Claude config for API access
      - ${HOME}/.claude:/home/agent/.claude

    # Pass through Anthropic API key
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}

    # No special privileges
    security_opt:
      - no-new-privileges:true

    # Resource limits - configure via environment variables
    deploy:
      resources:
        limits:
          cpus: '${AGENT_CPU_LIMIT:-4}'
          memory: ${AGENT_MEMORY_LIMIT:-8G}
